エンジニア向けDevOpsハンズオン - ハンズオン手順書
=================================================
このドキュメントは、「エンジニア向けDevOpsハンズオン」のハンズオン手順書です。

## イントロダクション

### このハンズオンで体験いただく内容
このハンズオンでは、以下のOralce Cloud Serviceを利用して、企業に存在するアプリケーションのモダナイズを行う作業を体験いただきます。

- Oracle Mobile Cloud Service (MCS)
- Oracle Application Container Cloud Service (ACCS)
- Oracle Developer Cloud Service (DevCS)

このハンズオンでは、既存アプリケーションとしてWebの勤怠入力アプリケーションを想定し、2つのPhaseに分けてモダナイズを進めていきます。

- Phase 1:
  * MCSを使って既存の勤怠アプリのモバイル化を行います
- Phase 2:
  * ACCSを使って勤怠アプリに機能拡張のAPIを追加します。また、MCSでモバイルアプリ側の機能拡張APIへの対応を行います
  * DevCSを使ったチーム開発のプロジェクト管理も、ここで併せて体験します


### ハンズオンシナリオにおける登場人物
このハンズオンのシナリオでは、以下の登場人物を想定します。

#### ・フロントエンド開発者(F)

<img src=".\img_role\frontend_developer.PNG" width=12%>

モバイルアプリケーションの開発を担当するエンジニアです。MCSのフロントエンド開発機能であるMAXを利用して、モバイルアプリケーションの開発を行います。

#### ・バックエンド開発者(B)

<img src=".\img_role\backend_developer.PNG" width=12%>

サーバー側の開発を担当するエンジニアです。MCSのモバイルバックエンド、及びACCSを利用して、フロントエンド（モバイルアプリケーション）に提供するAPI等の開発を行います。


#### ・プロジェクト管理者(M)

<img src=".\img_role\project_manager.PNG" width=12%>

プロジェクトの管理者です。チーム開発のプロジェクト管理のため、Developer Cloud Serviceのセットアップや、Issueの作成などをおこないます。


以降の手順では、作業のまとまり毎に、どの登場人物が実施するものかを明示します。<br>
現実のチーム開発においては、複数の関係者が分担して作業を行うことになります。そのような様子をイメージながら、ハンズオンを進めて見てください。

---

## Phase 1. 勤怠管理システムのモバイル化

Phase 1では、企業にすでに存在するWebの勤怠管理システムを、Mobile Cloud Serviceを利用してモバイル化します。

作成後のアプリケーションの構成は下の図のようになります。

<div align="center"><img src=".\img_mcs\mobile-structure.PNG" width=70%></div>

MCSでは、モバイル・アプリケーションから利用する業務システムへの接続情報をコネクタ（Connector）として定義します。<br>
モバイル・アプリに対して公開するCustom APIは、Connectorを介することで、実際の業務システムのAPIにアクセスできます。<br>
コネクタ・タイプ（コネクタの接続対象）は、REST Webサービス、SOAP Webサービス、Oracle Integration Cloud Service（ICS）、およびFusion Applications（FA）ベースのOracle Cloudアプリケーションを選択できます。


### 事前準備）Mobile Cloud Service(MCS)環境にログインする

- **Step-1**
  ブラウザでOracle Cloudダッシュボード画面のURLにアクセスします。表示された画面でDomainを入力し、Goをクリックします。
  * URL: 別紙にてご案内した文字列を入力してください。（例：https://myservices.oraclecloud.com/mycloud/faces/gDashboard.jspx ）
  * Domain: 別紙にてご案内した文字列を入力してください。（例：gse00002997）

  <div align="center"><img src=".\img_mcs\login\1.PNG" width=70%></div>

- **Step-2**
  以下の値を入力して、Sign Inボタンをクリックします。
  * User: Oracle Cloudのログインユーザ名。（別紙にてご案内した文字列を入力してください。）
  * Password: Oracle Cloudのログインパスワード。（別紙にてご案内した文字列を入力してください。）

  <div align="center"><img src=".\img_mcs\login\2.PNG" width=70%></div>

- **Step-3**
  Mobile Environmentボタンをクリックします。

  <div align="center"><img src=".\img_mcs\login\3.PNG" width=70%></div>

- **Step-4**
  Mobile Environment Service画面が表示されます。

  <div align="center"><img src=".\img_mcs\login\4.PNG" width=70%></div>

  下にスクロールして、Service Instance URLをクリックします。

  <div align="center"><img src=".\img_mcs\login\4-2.PNG" width=70%></div>

- **Step-5**
  ORACLEロゴの隣にあるアイコンをクリックします。

  <div align="center"><img src=".\img_mcs\login\5.PNG" width=70%></div>

  MCSの開発画面が表示されます。

  <div align="center"><img src=".\img_mcs\login\5-2.PNG" width=70%></div>


### P1-B-1. APIとconnectorテスト用のbackendを作る

<img src=".\img_role\backend_developer.PNG" width=12%>

これはバックエンド開発者がおこなう作業です。

モバイルバックエンドは、一連のモバイルアプリに対するAPIやその他のリソースをグループ化する概念です。Backendを作成する事により、APIとconnectorを利用することができるようになります。

- **Step-1**
  Applications > Mobile Backends > New Mobile Backendをクリックします。

  <div align="center"><img src=".\img_mcs\backend\1.PNG" width=70%></div>

- **Step-2**
  New Mobile Backend画面で以下の値を入力して、Createをクリックします。[連番]には、自身に割り振られてている2桁の環境の番号を記述してください。
  * Name: attendance\_backend-[連番]
    - 例）attendance\_backend-01
  * Description: attendance backend [連番]
    - 例）attendance backend 01

  <div align="center"><img src=".\img_mcs\backend\2.PNG" width=70%></div>


### P1-B-2. 勤怠管理システムのSOAP APIに接続するMCS Connectorを作る

<img src=".\img_role\backend_developer.PNG" width=12%>

これはバックエンド開発者がおこなう作業です。

コネクタは、モバイルバックエンドが外部サービスと通信できるようにする手段であり、モバイルアプリがそのサービスの機能とやりとりすることを可能にします。コネクタAPIは、外部サービスと通信してデータを送受信するための構成です。

SOAPは、XMLベースのメッセージングを使用する通信プロトコルです。SOAPコネクタAPIを使用すると、WebアプリケーションまたはサービスはSOAPポート上でメッセージを受信し、アウトバウンドSOAPメッセージを作成できできます。

この節では、レガシーシステムのSOAP APIに接続するためのSOAP Connector APIの作成の各手順（リモート・サービスのWSDLの場所の指定、ポートの設定、セキュリティ・ポリシーの設定、エンドポイントのテストなど）を実施します。

- **Step-1**
  Applications > Connectors > SOAPをクリックします。

  <div align="center"><img src=".\img_mcs\soap_connector\connector1.PNG" width=70%></div>

- **Step-2**
  New SOAP Connector API画面で以下の値を入力して、Createをクリックします。
  * API Display Name: attendance\_api
  * API Name: attendance\_api
  * WSDL URL:
    - https://attendancemanagement-gse00002265.apaas.em2.oraclecloud.com/AttendanceManagement/webservice/AttendanceWS?wsdl  （「https://attendancemanagement-gse00002265.apaas.em2.oraclecloud.com 」の部分は、ACCSで稼働しているレガシーシステムのURLを参照してください。 ）
  * Short Description: attendance api

  <div align="center"><img src=".\img_mcs\soap_connector\connector2.PNG" width=70%></div>

- **Step-3**
  Configure SOAP API画面でAPI Display Name、API Name、WSDL URL、Short Descriptionをそのままにして、以下の値を入力して、次へボタンをクリックします。
  * HTTP Read Timeout: 25000
  * HTTP Connection Timeout: 25000

  <div align="center"><img src=".\img_mcs\soap_connector\connector3.PNG" width=70%></div>

- **Step-4**
  Configure SOAP API画面でService、Portをそのままにして、以下の値を入力して、次へボタンをクリックします。
  * Endpoint:
    - https://attendancemanagement-gse00002265.apaas.em2.oraclecloud.com/AttendanceManagement/webservice/AttendanceWS?wsdl（「https://attendancemanagement-gse00002265.apaas.em2.oraclecloud.com 」の部分は、ACCSで稼働しているレガシーシステムを参照してください。 ）

  <div align="center"><img src=".\img_mcs\soap_connector\connector4.PNG" width=70%></div>

- **Step-5**
  そのままにして、次へボタンをクリックします。

  <div align="center"><img src=".\img_mcs\soap_connector\connector5.PNG" width=70%></div>

- **Step-6**
  そのままにして、Doneボタンをクリックします。テストしたい場合、下のTestステップを実行した後、Doneボタンをクリックします。

  <div align="center"><img src=".\img_mcs\soap_connector\connector6.PNG" width=70%></div>

- **Test**
  上のステップで各メソッドのテストができます。ここでは、getOneメソッドのテストを紹介します。
  HTTP Body部分のarg0を1にして、Mobile Backendにattendance\_backend-[連番]を選択し、Test Endpointをクリックします。

  <div align="center"><img src=".\img_mcs\soap_connector\test.PNG" width=70%></div>

  画面下部にレスポンス JSON オブジェクトが表示されます。

  <div align="center"><img src=".\img_mcs\soap_connector\test2.PNG" width=70%></div>

- **Step-7**
  attendance\_apiを選択して、Publishボタンをクリックします。一旦Publishすると、以降、これを修正することはできません。

  <div align="center"><img src=".\img_mcs\soap_connector\connector7.PNG" width=70%></div>


### P1-B-3. 勤怠管理システムのMCS Connectorに接続するMCS Express APIを作る

<img src=".\img_role\backend_developer.PNG" width=12%>

これはバックエンド開発者がおこなう作業です。

Express API Designerを使用すると、最小限の労力で迅速にAPIを作成できます。Express API Designerを使用してカスタムAPIを作成するために、コードを書く必要はありません。必要なのはサンプルデータだけです。

Express API Designerを使用すると、個々のエンドポイントとメソッドを定義する必要はありません。代わりに、Express API Designerは、JSONインスタンスとしてフォーマットされた一連のサンプル・データを入力する際に、GET、POST、PATCH、CREATE、およびDELETEエンドポイントのセットを生成します。<br>
メソッドのリクエストとレスポンスを設定するか、サンプルデータを入力して、エディタを使用してAPIを完成させることができます。この時点で、エンドポイントをテストし、返されるダミーデータを見て、開発作業の一環としてAPIを使用する準備が整います。
サービス開発者はJavaScriptとNodeを使用してこのAPIのサービスを実装できます。

- **Step-1**
  Applications > APIs> New API > Express APIをクリックします。

  <div align="center"><img src=".\img_mcs\express_api\1.PNG" width=70%></div>

- **Step-2**
  New Express API画面で以下の値を入力して、Createをクリックします。
  * API Display Name: attendance
  * API Name: attendance
  * Short Description: [任意の文字列]

  <div align="center"><img src=".\img_mcs\express_api\2.PNG" width=70%></div>

- **Step-3**
  General画面はそのままにします。

  <div align="center"><img src=".\img_mcs\express_api\3.PNG" width=70%></div>

- **Step-4**
  Resources画面でNew Resourceボタンをクリックします。

  <div align="center"><img src=".\img_mcs\express_api\4.PNG" width=70%></div>

- **Step-5**
  Create Resource画面で以下の値を入力して、Nextボタンをクリックします。
  * Display Name: attendanceInfo
  * Name: attendanceinfo
  * Display Name(plural): attendanceInfo

  <div align="center"><img src=".\img_mcs\express_api\5.PNG" width=70%></div>

- **Step-6**
  Create Resource画面でAdd Sample Dataボタンをクリックします。

  <div align="center"><img src=".\img_mcs\express_api\6.PNG" width=70%></div>

- **Step-7**
  MCS connector attendance\_apiのgetAllメソッドからのテスト レスポンス データをSample Dataに貼り付けます。データはこのドキュメントを含むリポジトリの、[attendance\_api\_sample\_data.json](./source/attendance_api_sample_data.json)の内容を入力してください。

  <div align="center"><img src=".\img_mcs\express_api\7.PNG" width=70%></div>

```json
[
  {
    "date": "2018-02-01",
    "div": "1",
    "gaishutsuTime": "01:00",
    "id": "1",
    "modoriTime": "02:00",
    "note": "note",
    "shukkinTime": "02:00",
    "taikinTime": "04:00",
    "week": "木"
  },
  {
    "date": "2018-02-02",
    "div": "2",
    "gaishutsuTime": "11:00",
    "id": "2",
    "modoriTime": "12:00",
    "note": "beikao",
    "shukkinTime": "10:00",
    "taikinTime": "13:00",
    "week": "金"
  },
  {
    "date": "2018-02-03",
    "div": "1",
    "gaishutsuTime": "00:00",
    "id": "3",
    "modoriTime": "00:00",
    "shukkinTime": "00:00",
    "taikinTime": "00:00",
    "week": "土"
  },
  {
    "date": "2018-02-04",
    "div": "1",
    "gaishutsuTime": "00:00",
    "id": "4",
    "modoriTime": "00:00",
    "shukkinTime": "00:00",
    "taikinTime": "00:00",
    "week": "日"
  },
  {
    "date": "2018-02-05",
    "div": "5",
    "gaishutsuTime": "00:00",
    "id": "5",
    "modoriTime": "00:00",
    "note": "待修",
    "shukkinTime": "00:00",
    "taikinTime": "00:00",
    "week": "月"
  },
  {
    "date": "2018-02-06",
    "id": "6",
    "week": "火"
  },
  {
    "date": "2018-02-07",
    "div": "1",
    "gaishutsuTime": "00:00",
    "id": "7",
    "modoriTime": "00:00",
    "shukkinTime": "23:00",
    "taikinTime": "22:00",
    "week": "水"
  },
  {
    "date": "2018-02-08",
    "div": "1",
    "gaishutsuTime": "00:00",
    "id": "8",
    "modoriTime": "00:00",
    "shukkinTime": "00:00",
    "taikinTime": "00:00",
    "week": "木"
  },
  {
    "date": "2018-02-09",
    "div": "1",
    "gaishutsuTime": "00:00",
    "id": "9",
    "modoriTime": "00:00",
    "shukkinTime": "00:00",
    "taikinTime": "00:00",
    "week": "金"
  },
  {
    "date": "2018-02-10",
    "div": "1",
    "gaishutsuTime": "00:00",
    "id": "10",
    "modoriTime": "00:00",
    "shukkinTime": "00:00",
    "taikinTime": "00:00",
    "week": "土"
  },
  {
    "date": "2018-02-11",
    "id": "11",
    "week": "日"
  },
  {
    "date": "2018-02-12",
    "div": "1",
    "gaishutsuTime": "00:00",
    "id": "12",
    "modoriTime": "00:00",
    "shukkinTime": "00:00",
    "taikinTime": "00:00",
    "week": "月"
  }
]
```

- **Step-8**
  そのままNextボタンをクリックします。

  <div align="center"><img src=".\img_mcs\express_api\8.PNG" width=70%></div>


- **Step-9**
  そのままFinishボタンをクリックします。
  このステップでEndpointsの生成が完了します。

  <div align="center"><img src=".\img_mcs\express_api\9.PNG" width=70%></div>

- **Step-10**
  Endpoint一覧画面に、自動的に生成した五つのEndpointがあります。
  各Endpointを選択し、Mobile Backendにattendance\_backend-[連番]を選択し、Test Endpointボタンをクリックすると、Endpointのテストができます。

  <div align="center"><img src=".\img_mcs\express_api\10.PNG" width=70%></div>

- **Step-11**
  Implementation > JavaScript Scaffoldボタンをクリックすると、生成したEndpointsのソースファイルがダウンロードできます。

  <div align="center"><img src=".\img_mcs\express_api\11.PNG" width=70%></div>

  Zipファイルがダウンロードされます。任意のディレクトリで解凍すると、次のファイルが含まれています。
  - attendance.js
    * JavaScriptのスケルトン・コード
  - package.json
    * APIライブラリの名前やバージョンを記述するJSONファイル
  - samples.txt
    * APIの実装によく使用されるコード・スニペット

- **Step-12**
  attendance.jsをテキスト・エディタで開きます。MCSのAPIデザイナで定義されているエンドポイントと同じ関数が定義されていることが確認できます。

  <div align="center"><img src=".\img_mcs\express_api\endpoints2.PNG" width=70%></div>

  <div align="center"><img src=".\img_mcs\express_api\endpoints1.PNG" width=70%></div>

  attendance.jsのpatchコールバック関数の定義を次の図の様子からテキストのように変更します。

  <div align="center"><img src=".\img_mcs\express_api\code_1.PNG" width=70%></div>

  ```js
    service.patch('/mobile/custom/attendance/attendanceinfo/:id', function(req,res) {
  		var id = req.params.id;
  		if(req.body.gaishutsuTime) req.body.gaishutsuTime = req.body.gaishutsuTime.substring(1,6);
  		if(req.body.modoriTime) req.body.modoriTime = req.body.modoriTime.substring(1,6);
  		if(req.body.shukkinTime) req.body.shukkinTime = req.body.shukkinTime.substring(1,6);
  		if(req.body.taikinTime) req.body.taikinTime = req.body.taikinTime.substring(1,6);
  		var body = {
  		   "Header": null,
  		   "Body": {
  		      "update": {
  		         "arg0": {
  		            "date": req.body.date,
  		            "div": req.body.div,
  		            "gaishutsuTime": req.body.gaishutsuTime,
  		            "id": id,
  		            "modoriTime": req.body.modoriTime,
  		            "note": req.body.note,
  		            "shukkinTime": req.body.shukkinTime,
  		            "taikinTime": req.body.taikinTime,
  		            "week": req.body.week
  		         }
  		      }
  		   }
  		};
  		 // res.send(200, body);
  		var sdk = req.oracleMobile;


  		sdk.connectors.attendance_api.post('update', body, {inType: 'json'}).then(
  		  function (result) {
  		    res.send(result.statusCode, result);
  		  },
  		  function (error) {
  		    res.send(error.statusCode, error.error);
  		  }
  		);
  	});
  ```

  attendance.jsのget detailコールバック関数の定義を次の図の様子からテキストのように変更します。

  <div align="center"><img src=".\img_mcs\express_api\code_2.PNG" width=70%></div>

  ```js
  service.get('/mobile/custom/attendance/attendanceinfo/:id', function(req,res) {
  		var id = req.params.id;
  		var body = {
  		   "Header": null,
  		   "Body": {
  		      "getOne": {
  		         "arg0": id
  		      }
  		   }
  		};
  		var sdk = req.oracleMobile;


  		sdk.connectors.attendance_api.post('getOne', body, {inType: 'json'}).then(
  		  function (result) {
  		  	var json_obj = JSON.parse(result.result);
  		  	var message = json_obj.Body.getOneResponse.return;
  		  	if(message.shukkinTime) message.shukkinTime = "T" + message.shukkinTime + ":00";
  		  	if(message.taikinTime) message.taikinTime = "T" + message.taikinTime + ":00";
  		  	if(message.gaishutsuTime) message.gaishutsuTime = "T" + message.gaishutsuTime + ":00";
  		  	if(message.modoriTime) message.modoriTime = "T" + message.modoriTime + ":00";
  		  	message.date = formatDate(new Date(message.date), 'M/d');
  		    res.send(result.statusCode, message);
  		  },
  		  function (error) {
  		    res.send(error.statusCode, error.error);
  		  }
  		);
  	});
  ```

  attendance.jsのget listコールバック関数の定義を次の図の様子からテキストのように変更します。

  <div align="center"><img src=".\img_mcs\express_api\code_3.PNG" width=70%></div>

  ```js
  service.get('/mobile/custom/attendance/attendanceinfo', function(req,res) {

  		var body = {
  		   "Header": null,
  		   "Body": {
  		      "getAll": null
  		   }
  		};
  		var sdk = req.oracleMobile;


  		sdk.connectors.attendance_api.post('getAll', body, {inType: 'json'}).then(
  		  function (result) {
  		  	var json_obj = JSON.parse(result.result);
  		  	var message = json_obj.Body.getAllResponse.return;
  		  	for(var index in message){

  					message[index].date = formatDate(new Date(message[index].date), 'M/d');

  			}
  		    res.send(result.statusCode, message);
  		  },
  		  function (error) {
  		    res.send(error.statusCode, error.error);
  		  }
  		);
  	});

  	formatDate = function  (date, format) {
  	  format = format.replace(/M/g, (date.getMonth() + 1));
  	  format = format.replace(/d/g, (date.getDate()));
  	  return format;
  	};

  ```

  package.jsonに次の一行を追記します。

  <div align="center"><img src=".\img_mcs\express_api\endpoints3.PNG" width=70%></div>

  修正後のファイルはこちらにもご用意しています（[attendance.zip](./source/attendance.zip)）。<br>
  続いて、修正したzipファイルをアップロードします。

  <div align="center"><img src=".\img_mcs\express_api\12.PNG" width=70%></div>

- **Step-13**
  Applications > APIs > attendanceを選択して、Publishボタンをクリックします。
  ドラフト状態のAPIのみ編集可能である。公開APIを開くと、読み込み専用の情報として表示されます。

  <div align="center"><img src=".\img_mcs\express_api\13.PNG" width=70%></div>


### P1-F-1. 勤怠管理システムのモバイルアプリを作る

<img src=".\img_role\frontend_developer.PNG" width=12%>

これはフロントエンド開発者がおこなう作業です。

#### アプリの基本設定

- **Step-1**
  Applications > Mobile Apps でモバイルの開発環境を開きます。

  <div align="center"><img src=".\img_max\v1\1.PNG" width=70%></div>

- **Step-2**
  New ApplicationボタンからMobile Applicationの基本設定や最初の画面のテンプレートを選択します。

  <div align="center"><img src=".\img_max\v1\2.PNG" width=70%></div>

- **Step-3**
  Application Nameを"Attendance Management [連番]"にして、Nextボタンををクリックします。

  <div align="center"><img src=".\img_max\v1\3.PNG" width=70%></div>

- **Step-4**
  Simple Screen with Summary Templateを選択し、Nextボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\4.PNG" width=70%></div>

- **Step-5**
  以下の値を入力して、Nextボタンをクリックします。
  * Screen Title: 一覧

  <div align="center"><img src=".\img_max\v1\5.PNG" width=70%></div>

- **Step-6**
  最初の画面のコンテンツをリストにして、Nextボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\6.PNG" width=70%></div>

- **Step-7**
  そのままCreateボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\7.PNG" width=70%></div>

#### 一覧画面

- **Step-1**
  アプリの基本設定が完了したら、下のようなモバイルアプリの開発画面が表示されます。

  <div align="center"><img src=".\img_max\v1\page1-1.PNG" width=70%></div>

- **Step-2**
  コンポーネントのサイズを調整します。
  一覧画面の上のコンポーネントを選択した状態で、右のPropertiesタブのSummary SizeをCustomにして、値を160に設定します。

  <div align="center"><img src=".\img_max\v1\page1-2.PNG" width=70%></div>

- **Step-3**
  コンポーネントのコンテンツをMetricにします。後続の作業で、ノー残業デー通知機能とプレミアムフライデー通知機能をここに表示します。<br>
  一覧画面の上のコンポーネントを選択した状態で、左のコンポーネントタブのMetricをクリックします。

  一覧画面は下のようになります。

  <div align="center"><img src=".\img_max\v1\page1-3.PNG" width=70%></div>

  一覧画面のMetricコンポーネントを選択した状態で、右のPropertiesタブのLabelを空白にします。

  <div align="center"><img src=".\img_max\v1\page1-3-2.PNG" width=70%></div>

- **Step-4**
  一覧画面のListコンポーネントのTitleアイテムを選択したら、一覧画面が下のようになります。Listコンポーネントの各アイテムを選択し、右のタブで各アイテムの個別設定ができます。

  <div align="center"><img src=".\img_max\v1\page1-4.PNG" width=70%></div>

- **Step-5**
  一覧画面のListコンポーネントのTitleアイテムを選択した状態で、右のDataタブのBrowse Service Catalogをクリックします。

  <div align="center"><img src=".\img_max\v1\page1-5.PNG" width=70%></div>

  前に作ったattendanceというAPIを選択し、Nextボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page1-5-2.PNG" width=70%></div>

  Show object descriptionsをチェックしてから、attendanceinfoを選択し、Selectボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page1-5-3.PNG" width=70%></div>

  下のようなデータ設定画面が表示されます。

  <div align="center"><img src=".\img_max\v1\page1-5-4.PNG" width=70%></div>

  Business Objectのアイテムを選択し、 List Component Fields のアイテムをクリックすることで、Business Objectのアイテムが List Component Fields のアイテムのところに挿入されます。
  データを下のように設定し、Nextボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page1-5-5.PNG" width=70%></div>

  そのままFinishボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page1-5-6.PNG" width=70%></div>

  戻った一覧画面の様子。

  <div align="center"><img src=".\img_max\v1\page1-5-7.PNG" width=70%></div>

- **Step-6**
  一覧画面のListコンポーネントのGraphicアイテムを選択した状態で、右のDataタブのMap values to iconsをクリックします。

  <div align="center"><img src=".\img_max\v1\page1-6.PNG" width=70%></div>

  ポップアップウィンドウが出表示されます。
  ＋Valueボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page1-6-2.PNG" width=70%></div>

  五つのアイテムを追加し、＋ボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page1-6-3.PNG" width=70%></div>

  Image Galleryというポップアップウィンドウが表示されます。
  Customタブで画像をアップロードできます。

  <div align="center"><img src=".\img_max\v1\page1-6-4.PNG" width=70%></div>

  特定のアイコンを選択し、Selectボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page1-6-5.PNG" width=70%></div>

  戻ったMap Data Values to Iconsポップアップウィンドウの様子。

  <div align="center"><img src=".\img_max\v1\page1-6-6.PNG" width=70%></div>

  続いて他のアイコンを指定します。完了した後、Saveボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page1-6-7.PNG" width=70%></div>

  戻った一覧画面の様子。

  <div align="center"><img src=".\img_max\v1\page1-6-8.PNG" width=70%></div>

#### 詳細画面

- **Step-1**
  一覧画面のListコンポーネントを選択した状態で、右のActionsタブのCOMPONENT ACTIONをクリックします。

  <div align="center"><img src=".\img_max\v1\page2-pre-1.PNG" width=70%></div>

  List Itemを選択します。

  <div align="center"><img src=".\img_max\v1\page2-pre-2.PNG" width=70%></div>

  Tapを選択します。

  <div align="center"><img src=".\img_max\v1\page2-pre-3.PNG" width=70%></div>

  Navigate to Screenを右にドラッグします。

  <div align="center"><img src=".\img_max\v1\page2-pre-4.PNG" width=70%></div>

  ＋ボタンをクリックすることで詳細画面の作りが始まります。

  <div align="center"><img src=".\img_max\v1\page2-pre-5.PNG" width=70%></div>

  Screen Typeを選択し、Nextボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page2-pre-6.PNG" width=70%></div>

  以下の値を入力して、Nextボタンをクリックします。
  * Screen Title: 詳細

  <div align="center"><img src=".\img_max\v1\page2-pre-7.PNG" width=70%></div>

  そのままNextボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page2-pre-8.PNG" width=70%></div>

  そのままFinishボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page2-pre-9.PNG" width=70%></div>

  そのままSaveボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page2-pre-10.PNG" width=70%></div>

- **Step-2**
  Go to 詳細リンクをクリックします。

  <div align="center"><img src=".\img_max\v1\page2-data-1.PNG" width=70%></div>

  詳細画面の様子。

  <div align="center"><img src=".\img_max\v1\page2-data-2.PNG" width=70%></div>

  詳細画面のFORMコンポーネントを選択した状態で、右のDataタブのBrowse Service Catalogをクリックします。

  <div align="center"><img src=".\img_max\v1\page2-data-3.PNG" width=70%></div>

  ポップアップウィンドウを閉じます。

  <div align="center"><img src=".\img_max\v1\page2-data-4.PNG" width=70%></div>

  Business Object にattendanceInfoを選択します。

  <div align="center"><img src=".\img_max\v1\page2-data-5.PNG" width=70%></div>

  下のようなデータ設定画面が表示されます。

  <div align="center"><img src=".\img_max\v1\page2-data-6.PNG" width=70%></div>

  Business Objectのアイテムを選択し、 Form Component Fields のアイテムをクリックすると、Business Objectのアイテムが Form Component Fields のアイテムの位置に挿入されます。<br>
  アイテムの前にあるアイコンをドラッグすることで、アイテムの位置を変更できます。

  データを下のように設定し、Nextボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page2-data-7.PNG" width=70%></div>

  そのままFinishボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page2-data-8.PNG" width=70%></div>

- **Step-3**
  詳細画面が下のようになります。

  <div align="center"><img src=".\img_max\v1\page2-3.PNG" width=70%></div>

  idアイテムを選択し、右クリックする。idアイテムを削除します。

  <div align="center"><img src=".\img_max\v1\page2-3-2.PNG" width=70%></div>

- **Step-4**
  FORMコンポーネントの各アイテムを選択し、右のPropertiesタブのField Labelで各アイテムのラベルを変更できます。 Read Onlyにすることも可能です。

  <div align="center"><img src=".\img_max\v1\page2-4.PNG" width=70%></div>

  各アイテムのラベルを下のように修正します。

  <div align="center"><img src=".\img_max\v1\page2-4-2.PNG" width=70%></div>

- **Step-5**
  Formコンポーネントの勤務内容アイテムを選択し、右のPropertiesタブのField Typeを選択します。

  <div align="center"><img src=".\img_max\v1\page2-5.PNG" width=70%></div>

  勤務内容アイテムのField TypeをSelectにします。

  <div align="center"><img src=".\img_max\v1\page2-5-2.PNG" width=70%></div>

  勤務内容アイテムを選択し、右のDataタブのFixed List of Valuesボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page2-5-3.PNG" width=70%></div>

  ポップアップウィンドウが表示されます。
  ＋Valueボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page2-5-4.PNG" width=70%></div>

  データを下のように設定し、Saveボタンをクリックします。

  <div align="center"><img src=".\img_max\v1\page2-5-5.PNG" width=70%></div>

- **Step-6**
  Formコンポーネントの出勤アイテムを選択し、右のPropertiesタブのField Typeを選択します。

  <div align="center"><img src=".\img_max\v1\page2-6.PNG" width=70%></div>

  出勤アイテムのField TypeをDate Timeに設定します。<br>
  出勤アイテムのDisplayをTimeに設定します。

  <div align="center"><img src=".\img_max\v1\page2-6-2.PNG" width=70%></div>

  外出アイテム、戻りアイテム、退勤アイテムを出勤アイテムと同様に設定します。

  三角計のアイコンのボタンでモバイルアプリのテストを実施できます。

  <div align="center"><img src=".\img_max\v1\page2-6-3.PNG" width=70%></div>

- **Test**
  テストアカウントを入力します。

  <div align="center"><img src=".\img_max\v1\test.PNG" width=70%></div>

  一覧画面

  <div align="center"><img src=".\img_max\v1\test2.PNG" width=70%></div>

  詳細画面

  <div align="center"><img src=".\img_max\v1\test3.PNG" width=70%></div>


Phase 1. の作業は、以上です。

---

## Phase 2. ノー残業デー通知機能とプレミアムフライデー通知機能の追加

通知機能の構成図は下の右の部分のようになる。

<div align="center"><img src=".\img\all_structure.PNG" width=70%></div>

通知機能で実現したい機能は、当日が「ノー残業デー」（毎週の水曜日）又は「プレミアムフライデー」（毎月の最後の金曜日）だった場合、モバイル化済みのスマートフォン・アプリで、「ノー残業デー」又は「プレミアムフライデー」であることをメッセージで表示するという機能となります。

これを実現するために、まず、上記の図で示している「拡張API」を作成します。「拡張API」は外からアクセス出来るREST APIを公開します。当日が特別な日であるかを判断し、適当のメッセージを呼出し元に返します。変更の内容を速やかに、自動的にデリバリするために、DevCSのGitリポジトリ機能、ビルド機能及びACCSへ自動デプロイ機能を利用します。ローカルで（Eclipseを利用）開発したソースコードをDevCSのGitリポジトリへ同期化することより、自動的にACCSへデプロイします。

次には、新しいMCSのAPIを作成します。MCSをカスタマイズすることにより、コネクタを介して、「拡張API」をアクセスします。

最後に、スマートフォン・アプリ側（MAXで開発したアプリ）に、メッセージを表示するために、MAXの画面UIを修正します。MAXの画面とMCSのカスタムAPIをバンディングすることにより、MCSのカスタムAPIが取得したメッセージをMAXの画面に表示します。


### 事前準備）Developer Cloud Service(DevCS) / Application Container Cloud Service(ACCS)環境にログインする

「拡張API」の開発のため、DevCSにログインします。この後に、DevCSのプロジェクトを作成及び関連の設定をします。

- **Step-1**
  ブラウザでOracle Cloudログイン用のURLをアクセスし、表示された画面でDomainを入力し、Goをクリックします。
  * URL: 別紙にてご案内した文字列を入力してください。（例：https://myservices.emea.oraclecloud.com/mycloud/cloudportal/dashboard）
  * Domain: 別紙にてご案内した文字列を入力してください。（例：gse00002265）

  <div align="center"><img src=".\img2\DevCSLogin1-1.PNG" width=70%></div>

- **Step-2**
  Oracle Cloudのユーザ名とパスワードを入力します。
  * User: Oracle Cloudのログインユーザ名。（別紙にてご案内した文字列を入力してください。）
  * Password: Oracle Cloudのログインパスワード。（別紙にてご案内した文字列を入力してください。）

  <div align="center"><img src=".\img2\DevCSLogin1-2.PNG" width=70%></div>

- **Step-3**
  DashBoard画面が表示します。

  <div align="center"><img src=".\img2\DevCSLogin1-3.PNG" width=70%></div>


### P2-M-1. DevCSプロジェクトを作成する

<img src=".\img_role\project_manager.PNG" width=12%>

これはプロジェクトの管理者がおこなう作業です。

Developer Cloud Serviceの中でインスタンスは一つですが、複数のプロジェクトを利用することが可能です。数ステップで簡単にプロジェクトを新規作成出来ます。下記のステップに従って、DevCSのプロジェクトを作成します。

- **Step-1**
  DashBoardに「developerXXXXX」（XXXXXは4-5桁の連番）が表示されているかを確認します。（非表示の場合、DashBoard画面の「Customize DashBoard」より、DevCSを表示させてください。）

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSProject作成1-1.PNG" width=70%></div>

- **Step-2**
  developerXXXXXのメニューを開き、Open Service Consoleを選択します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSProject作成1-2.PNG" width=70%></div>

- **Step-3**
  +New Projectをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSProject作成1-3.PNG" width=70%></div>

- **Step-4**
  Detailsの画面で、下記を入力し、Nextをクリックします。
  * Name: Notice
  * Description: 通知機能です。
  * Security: Sharedを選択してください

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSProject作成1-4.PNG" width=70%></div>

- **Step-5**
  Empty Projectを選択し、Nextをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSProject作成1-5.PNG" width=70%></div>

- **Step-6**
  MARKDOWNを選択し、Finishをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSProject作成1-6.PNG" width=70%></div>

- **Step-7**
  Project作成中の画面を確認します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSProject作成1-7.PNG" width=70%></div>

- **Step-8**
  Project作成完了の画面を確認します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSProject作成1-8.PNG" width=70%></div>

- **Step-9**
  ＋New Repositoryをクリックし、下記を内容を入力し、Createをクリックします。
  * Name: Notice
  * Initial content: Empty Repositoryを選択してください

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSProject作成1-9.PNG" width=70%></div>

- **Step-10**
  Git Repository作成完了の画面を確認します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSProject作成1-10.PNG" width=70%></div>


### P2-M-2. DevCSプロジェクトにIssueを登録する

<img src=".\img_role\project_manager.PNG" width=12%>

これはプロジェクトの管理者がおこなう作業です。

Developer Cloud Serviceの中で、不具合や機能追加等を課題（Issue）として管理することが可能です。IssueのOwnerあるいはCCにDevCSプロジェクト内のメンバーを指定することで、Issueの作成、更新があった際にメールが送信されることも可能です。

このプロジェクト開発におけるタスクを管理するために、タスクを分けてIssueとして登録します。タスク一覧は下記です。

- 通知機能REST APIの開発
- MCSの通知APIのモックを作成
- MAX UIの変更及びテスト（MCSの通知APIのモックを使用）
- 通知APIモックを本物に置き換える

通知機能REST APIの開発作業は時間かかりますので、作業待ちにならない様に、MCSの通知APIのモックを作成します。MAX UI変更後すぐテスト出来ます。通知機能REST APIの開発作業が完了後、MCSの通知APIモックを本物に置き換えます。

- **Step-1**
  DevCSのメニューからIssuesを選択し、＋New Issueをクリックします。）

  <div align="center"><img src=".\img2\DevCSIssue作成1-1.PNG" width=70%></div>

- **Step-2**
  New Issue入力画面で、下記を入力し、＋Create Issueをクリックします。
  * Summary: 通知機能REST APIの開発
  * Type: Task
  * Status: New

  <div align="center"><img src=".\img2\DevCSIssue作成1-2.PNG" width=70%></div>

- **Step-3**
  登録したIssueを確認します。

  <div align="center"><img src=".\img2\DevCSIssue作成1-3.PNG" width=70%></div>

- **Step-4**
  同様に下記のタスクを登録します。
  * MCSの通知APIのモックを作成
  * MAX UIの変更及びテスト（MCSの通知APIのモックを使用）
  * 通知APIモックを本物に置き換える

  <div align="center"><img src=".\img2\DevCSIssue作成1-4.PNG" width=70%></div>


### P2-B-1. 通知機能のREST APIを開発する

<img src=".\img_role\backend_developer.PNG" width=12%>

これはバックエンド開発者がおこなう作業です。

通知機能REST APIの開発します。当日が特別な日であるかを判断し、適当のメッセージを呼出し元に返します。変更の内容を速やかに、自動的にデリバリするために、DevCSのGitリポジトリ機能、ビルド機能及びACCSへ自動デプロイ機能を利用します。ローカルで（Eclipseを利用）開発したソースコードをDevCSのGitリポジトリへ同期化することにより、自動的にACCSへデプロイします。

#### DevCSのIssueの更新

担当のタスクに対するDevCSのIssueを開いて、IssueのステータスをAssignedに更新します。
- Status: Assigned

  <div align="center"><img src=".\img2\DevCSのIssueを更新する1-1.PNG" width=70%></div>

#### Eclipseによるアプリケーションの開発

従来の通りに、Eclipseを利用して、ローカルでREST APIを開発及びテストをします。DevCSを利用するなら、Oracle Enterprise Pack for Eclipse (OEPE)またはNetBeansを推薦します。その理由は、この二つの統合開発環境の中のOracle Public Cloud用のプラグインから接続し、Developer Cloud Serviceの一部機能を利用することができるためです。このハンズオン手順書では、Oracle Enterprise Pack for Eclipse (12.2.1.6) Oxygenを利用しています。

開発に時間が掛かるため、開発したソースコードを提供しています。それをEclipseに導入すれば開発作業が済みます。今回通知機能Apiで使われているフレームワークは最近流行しているSpring Bootとなります。

- **Step-1**
  Eclipseを開きます。

  <div align="center"><img src=".\img2\ノー残業デー通知機能Eclipse開発1-1.PNG" width=70%></div>

- **Step-2**
  別途配布したソースコードをプロジェクトに導入します。File > Import...を選択します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能Eclipse開発1-2.PNG" width=70%></div>

- **Step-3**
  General > Projects from Folder or Archiveを選択し、Nextをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能Eclipse開発1-3.PNG" width=70%></div>

- **Step-4**
  ソースコードのルート・ディレクトリ(例：C:\Users\shenzhu\oepe-workspace-MCS-DevOps\Notice)を入力し、Finishをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能Eclipse開発1-4.PNG" width=70%></div>

- **Step-5**
  ソースコードを導入されたことを確認します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能Eclipse開発1-5.PNG" width=70%></div>

#### DevCSへのソースコードの同期

ローカルで開発したソースコードをDevCSのGitリポジトリへ同期します。

- **Step-1**
  EclipseでGit RepositoryのViewを表示します。Window > Show View > Other...を選択します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能EclipseGit設定1-1.PNG" width=70%></div>

- **Step-2**
  Git > Git Repositoriesを選択し、Openをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能EclipseGit設定1-2.PNG" width=70%></div>

- **Step-3**
  Git Repositoriesの中に、Create a new local Git repositoryをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能EclipseGit設定1-3.PNG" width=70%></div>

- **Step-4**
  ソースコードのルート・ディレクトリを入力し、Finishをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能EclipseGit設定1-4.PNG" width=70%></div>

- **Step-5**
  Git Repositoriesの中にNoticeを右クリック > Commitをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能EclipseGit設定1-5.PNG" width=70%></div>

- **Step-6**
  Unstaged Changesの中にあるファイルを全部選択(Ctrl+A)します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能EclipseGit設定1-6.PNG" width=70%></div>

- **Step-7**
  Unstaged Changesの中にあるファイルを全部Staged Changesにドラッグします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能EclipseGit設定1-7.PNG" width=70%></div>

- **Step-8**
  Commit Messageにメッセージ、Author、Committerを入力し、Commit and Push...をクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能EclipseGit設定1-8.PNG" width=70%></div>

- **Step-9**
  Destination Git Repository画面で、下記を内容を入力します。（他の欄はデフォルト値のままにします。）
  * URL: https://cloud.admin@developer.em2.oraclecloud.com/developer53420-gse00002265/s/developer53420-gse00002265_notice_8275/scm/Notice.git
  **DevCSのGit RepositoryのURLは、DevCSの画面で確認出来ます。下記Step-10を参照してください。**
  * Host: URLが入力した後、自動的に埋められます。
  * Repository path: URLが入力した後、自動的に埋められます。
  * Protocol: URLが入力した後、自動的に埋められます。
  * User: Oracle Cloudのログインユーザ名。（別紙にてご案内した文字列を入力してください。）
  * Password: Oracle Cloudのログインパスワード。（別紙にてご案内した文字列を入力してください。）
  * Store in Secure Store: チェックONにします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能EclipseGit設定1-9.PNG" width=70%></div>

- **Step-10**
  DevCSのGit RepositoryのURLは、DevCSの画面で確認出来ます。

  <div align="center"><img src=".\img2\ノー残業デー通知機能EclipseGit設定1-10.PNG" width=70%></div>

- **Step-11**
  Nextをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能EclipseGit設定1-11.PNG" width=70%></div>

- **Step-12**
  そのままでNextをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能EclipseGit設定1-12.PNG" width=70%></div>

- **Step-13**
  そのままでFinishをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能EclipseGit設定1-13.PNG" width=70%></div>

- **Step-14**
  問題がなければ、下記の結果画面が表示します。OKをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能EclipseGit設定1-14.PNG" width=70%></div>

- **Step-15**
  DevCSの画面を開いて、Codeを同期されたことを確認します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能EclipseGit設定1-15.PNG" width=70%></div>

#### DevCSのBuildのコンフィグレーション

DevCSのBuild機能を利用するために、関連の設定が必要です。下記ステップに従って設定します。

- **Step-1**
  DevCSの画面を開いて、メニューからBuildを選択し、New Jobをクリックます。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-1.PNG" width=70%></div>

- **Step-2**
  Job Nameを入力し、Saveをクリックします。
  * Job Name: notice-job

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-2.PNG" width=70%></div>

- **Step-3**
  Mainタブを選択し、下記の値を入力します。
  * JDK:JDK8

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-3.PNG" width=70%></div>

- **Step-4**
  BuildParametersタブには何も入力しません。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-4.PNG" width=70%></div>

- **Step-5**
  Source Controlタブを選択し、下記の値を入力します。
  * Source Control Option: Git
  * Repository: Notice.git
  * Name: origin
  * Reference Spec: +refs/heads/\*:refs/remotes/origin/\*
  * Branches: master

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-5.PNG" width=70%></div>

- **Step-6**
  Triggersタブを選択し、下記の値を入力します。
  * Based on SCM polling scheduleをチェックする

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-6.PNG" width=70%></div>

- **Step-7**
  Environmentタブには何も入力しません。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-7.PNG" width=70%></div>

- **Step-8**
  Build Stepタブを選択し、Add Build Stepをクリックし、invoke Maven 3を追加します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-8.PNG" width=70%></div>

- **Step-9**
  invoke Maven 3のオプションをそのままにします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-9.PNG" width=70%></div>

- **Step-10**
  Post Buildタブを選択し、下記の値を入力します。
  * Archive the artifactsをチェックする
  * Files To Archive: target/Notice-0.0.1-SNAPSHOT-dist.zip

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-10.PNG" width=70%></div>

- **Step-11**
  Advancedタブには何も入力しません。Saveをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-11.PNG" width=70%></div>

- **Step-12**
  Build Nowをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-12.PNG" width=70%></div>

- **Step-13**
  Buildが開始するまでしばらくお待ちください。プログレスバーが表示したら、Buildが開始したことを示します。Buildの詳細ログを確認したい場合、Consoleをクリックしてください。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-13.PNG" width=70%></div>

- **Step-14**
  Consoleが表示されたことを確認します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-14.PNG" width=70%></div>

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-15.PNG" width=70%></div>

- **Step-15**
  Buildが成功したことを確認します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSBuild配置1-16.PNG" width=70%></div>

#### DevCSのDeployのコンフィグレーション

DevCSのDeploy機能を利用するために、関連の設定が必要です。通知機能のフレームワークがSpring Bootを利用していますので、Deploy先は、より軽いACCSを選択します。下記ステップに従って設定します。

- **Step-1**
  DevCSの画面を開いて、メニューからDeployを選択し、New Configurationをクリックます。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSDeploy配置1-1.PNG" width=70%></div>

- **Step-2**
  New Depolyment Configuration画面で下記を入力し、Depolyment Targetの後ろにあるNew > Application Container Cloud...を選択します。
  * Configuration Name: Notice
  * Application Name: Notice

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSDeploy配置1-2.PNG" width=70%></div>

- **Step-3**
  Depoly to Application Container Cloud画面で下記を入力し、Test Connectionをクリックします。
  * Data Center: 使用するCloud環境に所属するData Centerを選択してください。DevCSのURLからは判明出来るので、そちらを参照しても良いです。
  * Identity Domain: 使用するCloud環境のDomainを選択してください。DevCSのURLからは判明出来るので、そちらを参照しても良いです。
  * User: Oracle Cloudのログインユーザ名。（別紙にてご案内した文字列を入力してください。）
  * Password: Oracle Cloudのログインパスワード。（別紙にてご案内した文字列を入力してください。）

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSDeploy配置1-3.PNG" width=70%></div>

- **Step-4**
  Connectが成功したことを確認します。Use Connectionをクリックし、前の画面に戻します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSDeploy配置1-4.PNG" width=70%></div>

- **Step-5**
  更に、Depoly to Application Container Cloud画面で下記を入力し、Saveをクリックします。
  * Runtime: Javaを選択します。
  * Subscription: Monthlyを選択します。
  * Type: Automaticを選択します。
  * Job: notice-jobが自動的選択される
  * Artifact: target/Notice-0.0.1-SNAPSHOT-dist.zipが自動的選択される
  * Include ACCS Depolymentをチェックオンにします。下記内容を入力します。

```json
{
    "memory": "2G",
    "instances": "1",
    "services": [{
        "identifier": "DBService",
        "type": "DBAAS",
        "name": "db12c-ee",
        "username": "oracleusr2",
        "password": "oracle"
    }]
}
```

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSDeploy配置1-5.PNG" width=70%></div>

- **Step-6**
  コンフィグレーションが成功に作成されたことを確認します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSDeploy配置1-6.PNG" width=70%></div>

- **Step-7**
  次回のBuild成功だった場合、自動的にACCSへデプロイ実行しますので、初回は手動でデプロイする必要です。下の図の様にStartをクリックします。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSDeploy配置1-7.PNG" width=70%></div>

- **Step-8**
  デプロイが成功したことを確認します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSDeploy配置1-8.PNG" width=70%></div>

- **Step-9**
  ACCSのアプリケーション一覧画面を開き、デプロイが成功したことを確認します。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSDeploy配置1-9.PNG" width=70%></div>

- **Step-10**
  通知機能の動作確認を実行します。
  ブラウザで下記のURLをアクセスしてください。
  https://notice-gse00002265.apaas.em2.oraclecloud.com/Notice/NoticeRest/getIsTodaySpecial?lang=ja

  「?lang=ja」の部分について説明します。指定の言語（日本語又は英語）のメッセージを返すために、Query Parameter（?lang=ja）をURLの後ろに付ける必要です。langの値は日本語の場合”ja”、英語の場合”en”と入力してください。

  「https://notice-gse00002265.apaas.em2.oraclecloud.com/」 の部分は、Step-9で表示しているACCSのアプリケーション画面を参照してください。
  下記の図の様に、JSONデータが正常に取得出来れば、通知機能が正常に動作していることが確認出来ます。

  <div align="center"><img src=".\img2\ノー残業デー通知機能DevCSDeploy配置1-10.PNG" width=70%></div>

#### DevCSのIssueの更新
担当のタスクに対するDevCSのIssueを開いて、IssueのステータスをResolvedに更新します。
- Status: Resolved

  <div align="center"><img src=".\img2\DevCSのIssueを更新する1-2.PNG" width=70%></div>


### P2-B-2. MCSの通知APIのモックを作成する

<img src=".\img_role\backend_developer.PNG" width=12%>

これはバックエンド開発者がおこなう作業です。

下記のステップで作成するMCS APIは、実際の通知機能REST APIを呼び出していないため、MCS API作成の時に指定されたSampleデータしか返さないことになります。いわゆる「モックAPI」となります。

作成するMCS APIは、MockのImplementationをデフォルトに設定されますが、本物のImplementationを実装して、アップロードすることにより、本物ののImplementationに切り替えることが可能です。

#### DevCSのIssueの更新

担当のタスクに対するDevCSのIssueを開いて、IssueのステータスをAssignedに更新します。
- tatus: Assigned

  <div align="center"><img src=".\img2\DevCSのIssueを更新する2-1.PNG" width=70%></div>

#### 通知機能のMCS APIの作成

MCS APIを作成する手順を示します。MCS未ログインの場合、MCSにログインしてください。MCS にログインする手順については、「勤怠管理システムのモバイル化」の「Oracle Cloud（MCSインスタンス付き）にログインする」章節をご参照ください。

- **Step-1**
  Applications > APIs> New API > APIをクリックする

  <div align="center"><img src=".\img_mcs\api\1.PNG" width=70%></div>

- **Step-2**
  New API画面で以下の値を入力して、Createをクリックする。
  * API Display Name: notice
  * API Name: notice
  * Short Description: 好きなようにしてください。

  <div align="center"><img src=".\img_mcs\api\2.PNG" width=70%></div>

- **Step-3**
  General画面をそのままにして、Endpoints画面でNew Resourceボタンをクリックする。

  <div align="center"><img src=".\img_mcs\api\3.PNG" width=70%></div>

- **Step-4**
  APIのエンドポイントを定義するためのリソースを作成する。リソースはAPIの要点である。タイプ、それに関連するデータ、他のリソースとの関係、およびそれに作用する1つ以上のメソッドを含む。リソースは、イメージ、テキストファイル、その他のリソースのコレクション、論理的なトランザクション、プロシージャなど、ほとんどすべてのものになる。
  画面でEndpointの名称をgetTodayInfoにして、Methodsボタンをクリックする。

  <div align="center"><img src=".\img_mcs\api\4.PNG" width=70%></div>

  次にメソッドの追加画面が出てくる。続いて、Add Methodボタンをクリックし、GETを選ぶ。

  <div align="center"><img src=".\img_mcs\api\4-2.PNG" width=70%></div>

- **Step-5**
  getTodayInfo詳細画面でResponsesタブをクリックして、Add Responseボタンをクリックする。
  そして、Bodyを展開して、Bodyの横にあるAdd Media Typeボタンをクリックする。
  以下の値を入力して、上にあるSaveボタンをクリックする。
  * Example: {"today":"2018-02-23","flag":"2","message":"today is the last friday of the month"}

  <div align="center"><img src=".\img_mcs\api\5.PNG" width=70%></div>

- **Step-6**
  Security画面でLogin Requiredスイッチをオフにする。

  <div align="center"><img src=".\img_mcs\api\6.PNG" width=70%></div>

- **Step-7**
  Schemaを追加する。Schemaがないと、Mobile Application AcceleratorはこのAPIを接続できない。

  <div align="center"><img src=".\img_mcs\api\7-1.PNG" width=70%></div>
  Schema画面で名称をnoticeにして、以下の値を右に入力します。上にあるSaveボタンをクリックする。

  ```json
  {
    "$schema": "http://json-schema.org/draft-04/hyper-schema#",
    "title": "singleton",
    "description": "attendanceInfo-singleton",
    "type": "object",
    "properties": {
      "flag": {
        "type": "string"
      },
      "today": {
        "type": "string",
        "format": "date-time"
      },
      "message": {
        "type": "string"
      }
    }
  }
  ```

  <div align="center"><img src=".\img_mcs\api\7-2.PNG" width=70%></div>

- **Step-8**
  Step-5の画面に戻って、Schemaにnoticeを選択し、保存する。

  <div align="center"><img src=".\img_mcs\api\8.PNG" width=70%></div>

- **Step-9**
  画面の上にあるTestをクリックし、動作確認します。下記を入力し、Test Endpointをクリックします。サンプルJSONデータがレスポンスされることを確認します。
  * Mobile Backend: attendance\_backend-[連番]

  <div align="center"><img src=".\img_mcs\api\8-1.PNG" width=70%></div>

  <div align="center"><img src=".\img_mcs\api\8-2.PNG" width=70%></div>

- **Step-10**
  Applications > APIs > noticeを選択して、Publishボタンをクリックする。
  ドラフト状態のAPIのみ編集可能である。公開APIを開くと、読み込み専用の情報として表示される。

  <div align="center"><img src=".\img_mcs\api\11.PNG" width=70%></div>

#### DevCSのIssueの更新

担当のタスクに対するDevCSのIssueを開いて、IssueのステータスをResolvedに更新します。
- Status: Resolved

  <div align="center"><img src=".\img2\DevCSのIssueを更新する2-2.PNG" width=70%></div>


### P2-F-1. MAX UIの変更及びテストを行う

<img src=".\img_role\frontend_developer.PNG" width=12%>

これはフロントエンド開発者がおこなう作業です。

下記のステップでは、通知メッセージをスマートフォン・アプリで表示するために、MAXの画面UIを修正します。MAXの画面とMCSのカスタムAPIをバンディングすることにより、MCSのカスタムAPIが取得したメッセージをMAXの画面に表示します。この段階では、MCSの通知APIのモックを使用して画面側のテストを行います。

#### DevCSのIssueの更新

担当のタスクに対するDevCSのIssueを開いて、IssueのステータスをResolvedに更新します。
- Status: Resolved

  <div align="center"><img src=".\img2\DevCSのIssueを更新する3-1.PNG" width=70%></div>

#### MAX UIの変更及びテスト（MCSの通知APIのモックを使用）

- **Step-1**
  「勤怠管理システムのモバイル化」の「勤怠管理システムのモバイルアプリを作る」章節を参照し、MAXの画面を開きます。MAX画面で、左のScreen Flowで一覧画面をダブルクリックします。

  <div align="center"><img src=".\img_max\v2\1.PNG" width=70%></div>

  一覧画面のMetricコンポーネントを選択した状態で、右のDataタブのBrowse Service Catalogをクリックします。

  <div align="center"><img src=".\img_max\v2\2.PNG" width=70%></div>

  前に作ったnoticeというAPIを選択し、Nextボタンをクリックします。

  <div align="center"><img src=".\img_max\v2\3.PNG" width=70%></div>

  Show object descriptionsをチェックしてから、singletonを選択し、Selectボタンをクリックします。

  <div align="center"><img src=".\img_max\v2\4.PNG" width=70%></div>

  下のようなデータ設定画面が表示されます。

  <div align="center"><img src=".\img_max\v2\5.PNG" width=70%></div>

  Business Objectのアイテムを選択し、 Metric Component Fields のアイテムをクリックすることで、Business Objectのアイテムが Metric Component Fields のアイテムのところに挿入されます。
  データを下のように設定し、Nextボタンをクリックします。

  <div align="center"><img src=".\img_max\v2\6.PNG" width=70%></div>

  そのままFinishボタンをクリックします。

  <div align="center"><img src=".\img_max\v2\7.PNG" width=70%></div>

  戻った一覧画面の様子。

  <div align="center"><img src=".\img_max\v2\8.PNG" width=70%></div>

  一覧画面の上のMetricコンポーネントを選択した状態で、右のPropertiesタブのValueをCustomにして、値を12に設定します。

  <div align="center"><img src=".\img_max\v2\9.PNG" width=70%></div>

- **Test**
  テストしたスクリーンショットの様子。

  <div align="center"><img src=".\img_max\v2\test-1.PNG" width=70%></div>

#### DevCSのIssueの更新

担当のタスクに対するDevCSのIssueを開いて、IssueのステータスをResolvedに更新します。
- Status: Resolved

  <div align="center"><img src=".\img2\DevCSのIssueを更新する3-2.PNG" width=70%></div>


### P2-B-3. 通知APIのモックを実際のAPIに置き換える

<img src=".\img_role\backend_developer.PNG" width=12%>

これはバックエンド開発者がおこなう作業です。

通知機能REST APIの開発作業が完了後、MCSの通知APIモックを本物に置き換えます。MCSをカスタマイズすることにより、コネクタを介して、通知機能REST APIにアクセスします。

#### DevCSのIssueの更新

担当のタスクに対するDevCSのIssueを開いて、IssueのステータスをAssignedに更新します。
- Status: Assigned

  <div align="center"><img src=".\img2\DevCSのIssueを更新する4-1.PNG" width=70%></div>

#### 通知機能のREST APIに接続するMCS REST Connectorの作成

RESTコネクタAPIは、モバイルアプリを既存のRESTサービスに接続する標準的な方法です。

ここでは、リモートサービスを指定し、セキュリティポリシーを設定してエンドポイントをテストすることから、REST Connector APIを作成する手順を示します。

- **Step-1**
  Applications > Connectors > New Connector > RESTをクリックします。

    <div align="center"><img src=".\img_mcs\rest_connector\1.PNG" width=70%></div>

- **Step-2**
  New REST Connector API画面で以下の値を入力して、Createをクリックする。
  * Display API Name: notice\_api
  * API Name: notice\_api
  * Remote URL: https://notice-gse00002265.apaas.em2.oraclecloud.com/Notice/NoticeRest/getIsTodaySpecial （開発した通知機能REST API が公開したURLを入力してください。Query Paramter ”?lang=ja” はMCSのAPIの中で指定するため、URLの中には含まれないようにしてください。「https://notice-gse00002265.apaas.em2.oraclecloud.com/」 の部分は、上で表示しているACCSのアプリケーション画面を参照してください。）
  * Short Description: [任意の文字列]

  <div align="center"><img src=".\img_mcs\rest_connector\2.PNG" width=70%></div>

- **Step-3**
  Configure REST API画面でDisplay API Name、API Name、Remote URL、Short Descriptionをそのままにして、以下の値を入力して、次へボタンをクリックします。
  * HTTP Read Timeout: 25000
  * HTTP Connection Timeout: 25000

  <div align="center"><img src=".\img_mcs\rest_connector\3.PNG" width=70%></div>

- **Step-4**
  そのまま次へボタンをクリックします。

  <div align="center"><img src=".\img_mcs\rest_connector\4.PNG" width=70%></div>

- **Step-5**
  そのまま次へボタンをクリックします。

  <div align="center"><img src=".\img_mcs\rest_connector\5.PNG" width=70%></div>

- **Step-6**
  そのままDoneボタンをクリックする。テストしたい場合、下のTestステップを実行した後、Doneボタンをクリックします。

  <div align="center"><img src=".\img_mcs\rest_connector\6.PNG" width=70%></div>

- **Test**
  テストの際に、通知機能REST APIに合わせて、Query ParameterをREST APIのURLの後ろに追加する必要があります。Local Resource Nameの欄に、?lang=jaの形で入力すれば、Query Parametersを設定することが出来ます。langの値は日本語の場合”ja”、英語の場合”en”と入力してください。

  Mobile Backendにattendance\_backend-[連番]を選択し、Test Endpointをクリックすると、下にレスポンス JSON オブジェクトが表示されます。
  * Local Resource Name: ?lang=ja
  * Mobile Backend: attendance\_backend-[連番]

  <div align="center"><img src=".\img_mcs\rest_connector\test.PNG" width=70%></div>

  <div align="center"><img src=".\img_mcs\rest_connector\test-1.PNG" width=70%></div>

- **Step-7**
  notice\_apiを選択して、Publishボタンをクリックします（一旦Publishすると、その後修正はできません）。

  <div align="center"><img src=".\img_mcs\rest_connector\7.PNG" width=70%></div>

#### 通知APIモックを実際のAPIに置き換える

既に作成したMCSのAPIをカスタマイズして、作成したConnectorを呼び出すことにより、本物の通知機能REST APIを呼び出します。<br>
カスタムAPIを使用すると、Node.jsを使用して、RESTインターフェイスを介して公開されたモバイルアプリケーションに必要なすべてのサービスをコーディングできます。

この節では、エンドポイントの定義、リソースタイプや特性の定義、セキュリティポリシーの設定などをおこなうことで、モックではない、実際のREST APIを作成する手順を示します。

- **Step-1**
  Implementation > JavaScript Scaffoldボタンをクリックすると、生成したEndpointsのソースファイルがダウンロードできます。

  <div align="center"><img src=".\img_mcs\api\9.PNG" width=70%></div>

  Zipファイルがダウンロードされます。任意のディレクトリで解凍すると、次のファイルが含まれます。
  - notice.js
    * JavaScriptのスケルトン・コード
  - package.json
    * APIライブラリの名前やバージョンを記述するJSONファイル
  - samples.txt
    * APIの実装によく使用されるコード・スニペット

  notice.jsをテキスト・エディタで開きます。

  <div align="center"><img src=".\img_mcs\api\code_1.PNG" width=70%></div>

  notice.jsのgetコールバック関数の定義を上の図の様子からテキストのように変更する。

  ```js
  service.get('/mobile/custom/notice/getTodayInfo', function(req,res) {
  var sdk = req.oracleMobile;

  var optionsList = {};
  var queryString = "?lang=ja"

  optionsList.uri = '/mobile/connector/notice_api' + queryString;

  sdk.rest.get(optionsList, function (error, response, body) {

  	if (error) {
            res.send(500, error);
        }else{
  		var message = JSON.parse(body);
  		res.status(response.statusCode).send(message);
  	}
  });
  });

  ```

  ここでは、MCS APIの中に、Query Parameter設定する方法を示しています。上記コードの中にある「queryString」の値を変更出来ます。langの値は日本語の場合”ja”、英語の場合”en”を指定すれば、その言語でメッセージを取得できます。

  package.jsonをテキスト・エディタで開く。

  <div align="center"><img src=".\img_mcs\api\code_2.PNG" width=70%></div>

  package.jsonのconnectorsの行を下記のように変更します。

  `"connectors" : {"/mobile/connector/notice_api":"1.0"}`

- **Step-2**
  修正したファイルを元のフォルダ構成でZipファイルに圧縮します（notice.zip）。修正したzipファイルをアップロードします。

  （下記の図の区域内にZipファイルをドラッグすれば、自動的にアップロードが開始します。アップロードしたファイルを自動的にデフォルトのImplementationに設定されます。テストするために、MockのImplementationをデフォルトに設定することにより、Mockに切り替えることも可能です。）

  <div align="center"><img src=".\img_mcs\api\10.PNG" width=70%></div>

- **Step-3**
  画面の上にあるTestをクリックし、動作確認します。下記を入力し、Test Endpointをクリックします。本物のJSONデータがレスポンスされることを確認します。

  * Mobile Backend: attendance\_backend-[連番]

  <div align="center"><img src=".\img_mcs\api\8-1.PNG" width=70%></div>

  <div align="center"><img src=".\img_mcs\api\8-3.PNG" width=70%></div>

- **Test**
  MAXのアプリケーションをもう一回テストします。本物のメッセージが表示されることを確認します。

  <div align="center"><img src=".\img_max\v2\test.PNG" width=70%></div>

#### DevCSのIssueの更新

担当のタスクに対するDevCSのIssueを開いて、IssueのステータスをResolvedに更新します。
- Status: Resolved

  <div align="center"><img src=".\img2\DevCSのIssueを更新する4-2.PNG" width=70%></div>


以上で、全てのPhaseの作業は完了です。
